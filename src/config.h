#ifndef CONFIG_H
#define CONFIG_H

// ========================================
// КОНФИГУРАЦИЯ ПИНОВ ESP32
// ========================================

// Пины ESP32 для управления триаками
#define TRIAC_L1_PIN 21    // Триак фазы L1
#define TRIAC_L2_PIN 19    // Триак фазы L2  
#define TRIAC_L3_PIN 18    // Триак фазы L3
#define ZERO_CROSS_PIN 15  // Детектор пересечения нуля

// Пины сенсоров
#define NTC_PIN 34         // Датчик температуры NTC
#define FLOW_SENSOR_PIN 35 // Датчик потока воды
#define STATUS_LED_PIN 2   // Светодиод статуса
#define BOOT_BUTTON_PIN 0  // Кнопка BOOT (встроенная кнопка ESP32)

// Дополнительные пины (из веб-сервера)
#define MOSFET_EN_PIN 4    // Пин управления MOSFET (если используется)

// ========================================
// НАСТРОЙКИ ПИД-РЕГУЛЯТОРА
// ========================================

#define PID_KP 0.8         // Пропорциональный коэффициент (снижен для стабильности)
#define PID_KI 0.05        // Интегральный коэффициент (снижен для предотвращения перерегулирования)
#define PID_KD 0.2         // Дифференциальный коэффициент (снижен для уменьшения колебаний)
#define PID_OUTPUT_MIN 0.0  // Минимальный выход (0%)
#define PID_OUTPUT_MAX 100.0 // Максимальный выход (100%)

// Дополнительные настройки ПИД для стабильности
#define PID_INTEGRAL_MAX 20.0  // Максимальное значение интегральной составляющей
#define PID_INTEGRAL_MIN -20.0 // Минимальное значение интегральной составляющей
#define PID_COMPUTE_INTERVAL_MS 100 // Интервал вычисления ПИД (мс)

// ========================================
// НАСТРОЙКИ ТЕМПЕРАТУРЫ
// ========================================

#define TARGET_TEMP 50.0           // Целевая температура по умолчанию (°C)
#define TARGET_TEMP_DEFAULT 50.0   // Целевая температура по умолчанию
#define TARGET_TEMP_MIN 30.0       // Минимальная целевая температура
#define TARGET_TEMP_MAX 70.0        // Максимальная целевая температура
#define TEMP_HYSTERESIS 1.0        // Гистерезис температуры
#define MAX_TEMP_SAFETY 80.0        // Максимальная безопасная температура

// ========================================
// НАСТРОЙКИ ПОТОКА ВОДЫ
// ========================================

#define FLOW_THRESHOLD_MIN 0.1     // Минимальный порог потока (л/мин)
#define FLOW_THRESHOLD_MAX 20.0     // Максимальный порог потока (л/мин)
#define FLOW_CALIBRATION_FACTOR 400.0 // Коэффициент калибровки по умолчанию (имп/л)
#define FLOW_CALIBRATION_MIN 100.0  // Минимальный коэффициент калибровки
#define FLOW_CALIBRATION_MAX 1000.0 // Максимальный коэффициент калибровки

// ========================================
// НАСТРОЙКИ ФАЗОВОГО УПРАВЛЕНИЯ
// ========================================

// Фазовые смещения (120° = 6667 мкс для 50Гц)
#define PHASE_SHIFT_US 6667        // Смещение между фазами
#define HALF_PERIOD_US 10000        // Половина периода сети
#define MIN_FIRE_DELAY_US 1000      // Минимальная задержка включения
#define MAX_FIRE_DELAY_US 8500      // Максимальная задержка включения
#define TRIAC_PULSE_US 1500         // Длительность импульса включения триака

// Фильтрация частоты
#define FREQ_FILTER_SAMPLES 5       // Количество образцов для фильтрации частоты

// ========================================
// НАСТРОЙКИ ДАТЧИКОВ
// ========================================

// Датчик потока
#define PULSES_PER_LITER 400.0     // Импульсов на литр по умолчанию
#define FLOW_TIMEOUT_MS 1000       // Таймаут отсутствия потока
#define MIN_PULSE_INTERVAL_MS 10   // Минимальный интервал между импульсами

// NTC датчик температуры
#define NOMINAL_TEMP 25.0           // Номинальная температура
#define NOMINAL_RESISTANCE 10000.0 // Сопротивление при 25°C
#define BETA_COEFFICIENT 3950.0    // Бета-коэффициент
#define SERIES_RESISTANCE 10000.0   // Подтягивающий резистор

// Фильтрация датчиков
#define FILTER_SAMPLES 5            // Количество образцов для фильтрации

// ========================================
// НАСТРОЙКИ СИСТЕМЫ
// ========================================

// Режимы работы системы
#define SYSTEM_MODE_SLEEP 0         // Режим глубокого сна
#define SYSTEM_MODE_ACTIVE 1        // Активная работа
#define SYSTEM_MODE_WIFI_SESSION 2 // WiFi сессия

// Временные настройки
#define RAMP_UP_TIME_MS 2000        // Время разгона до полной мощности
#define WIFI_SESSION_TIMEOUT_MS 900000 // Таймаут WiFi сессии (15 минут)

// Настройки кнопки BOOT
#define BOOT_BUTTON_DEBOUNCE_MS 50   // Защита от дребезга кнопки
#define BOOT_BUTTON_CLICK_TIMEOUT_MS 1000 // Таймаут между нажатиями для тройного клика
#define BOOT_BUTTON_CLICKS_REQUIRED 3     // Количество нажатий для активации WiFi

// Защитные настройки
#define MIN_FLOW_RATE_DEFAULT 0.5   // Минимальный поток по умолчанию
#define MIN_TEMP_DEFAULT 40.0       // Минимальная температура
#define MAX_TEMP_DEFAULT 65.0       // Максимальная температура

// ========================================
// НАСТРОЙКИ WiFi И ВЕБ-СЕРВЕРА
// ========================================

// WiFi настройки
#define WIFI_SSID "WaterHeater"     // Имя точки доступа
#define WIFI_PASSWORD "12345678"    // Пароль точки доступа
#define WIFI_CHANNEL 1              // Канал WiFi
#define WIFI_MAX_CONNECTIONS 4      // Максимальное количество подключений
#define WIFI_TX_POWER_FULL 19.5     // Полная мощность передачи (dBm)

// Веб-сервер
#define CONFIG_JSON_SIZE 1024       // Размер JSON конфигурации
#define DEBUG_SERIAL true           // Включить отладочный вывод

// ========================================
// НАСТРОЙКИ ПОСЛЕДОВАТЕЛЬНОГО ПОРТА
// ========================================

#define SERIAL_BAUD_RATE 115200     // Скорость последовательного порта

#endif